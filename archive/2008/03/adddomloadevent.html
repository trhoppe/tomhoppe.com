<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <title>TomHoppe.com: addDomLoadEvent</title>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="MSSmartTagsPreventParsing" content="true" />
<meta name="generator" content="Blogger" />
<link rel="icon" type="image/vnd.microsoft.icon" href="http://www.blogger.com/favicon.ico"/>
<link rel="alternate" type="application/atom+xml" title="TomHoppe.com - Atom" href="http://www.tomhoppe.com/atom.xml" />
<link rel="alternate" type="application/rss+xml" title="TomHoppe.com - RSS" href="http://www.tomhoppe.com/rss.xml" />
<link rel="service.post" type="application/atom+xml" title="TomHoppe.com - Atom" href="http://www.blogger.com/feeds/6064498188306872783/posts/default" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.blogger.com/rsd.g?blogID=6064498188306872783" />
<link rel="alternate" type="application/atom+xml" title="TomHoppe.com - Atom" href="http://www.blogger.com/feeds/6064498188306872783/8232425268208005748/comments/default" />
 <link rel="stylesheet" type="text/css" href="http://www.blogger.com/css/blog_controls.css"/> <link rel="stylesheet" type="text/css" href="http://www.blogger.com/dyn-css/authorization.css?targetBlogID=6064498188306872783&zx=e098ca30-f1ca-4a01-9164-7b82b52bbebe"/>

    <!-- used to create popup larger image -->
    <link rel="stylesheet" href="http://www.tomhoppe.com/css/thickbox.css" type="text/css"/>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.tomhoppe.com/js/thickbox.js"></script>
    <!-- used to create popup larger image -->
    
    <link rel="stylesheet" type="text/css" href="http://www.tomhoppe.com/css/siteStyles.css" />
    <link rel="stylesheet" type="text/css" href="http://www.tomhoppe.com/css/blogStyles.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
	
</head>

<body>
<div id="mainCentering">
<!-- START OF TOP SECTION -->
<div id="borderTop" class="clearfix">
	<img src="http://www.tomhoppe.com/images/cornerTL.gif" width="13" height="18" alt="" border="0" class="cornerL" />
	<img src="http://www.tomhoppe.com/images/cornerTR.gif" width="13" height="18" alt="" border="0" class="cornerR" />
</div>

<div id="border1"><div id="border2"><div id="border3">
<div id="mainContainer">
	<div id="topBar" class="clearfix">
		<h1>
			<a href="http://www.tomhoppe.com">tomhoppe.com<br /></a>
		</h1>
		<div class="siteDesc">
			Racing, Web Development, Photography, and Beer...Stuff that matters. 
		</div>
	</div>    
<!-- END OF TOP SECTION --> 


<!-- START OF ACTUAL BLOG -->

<div id="content" class="clearfix">
	
	<!-- Begin #main -->
	<div id="main"><div id="main2">

	

    
		<h2 class="date-header">Tuesday, March 18, 2008</h2>
	

	<!-- Begin .post -->
	<div class="post"><a name="8232425268208005748"></a>
		
			<h3 class="post-title">
			<a href="http://www.tomhoppe.com/2008/03/adddomloadevent.html">addDomLoadEvent</a>
			</h3>
		

		<div class="post-body">
            <div>
                <div style="clear:both;"></div><p>Using window.onload for Javascript creates a crappy UI, as it waits for the entire page, including all CSS, JS, and images to load. I avoided as much as possible, but for some things in the day job, we needed to use it. The best example being that we only had access to JS in the head of the page, but needed to immediately client side add some code to the bottom of the page. </p> <p>For this, we used addLoadEvent and waited till everything was done. Having been fed up with this, I did some a big of searching and found a solution from <a href="http://www.thefutureoftheweb.com/blog/adddomloadevent" target="_blank">The Future of the Web, by Jesse Skinner</a>. Jesse's script puts together a cross-browser way to wait for just the DOM to load, instead of all the images and text</p><p>This is easy for FF, Safari 3 Beta, and Opera, but a pain for IE and Safari 2. I changed his script slightly to be compatible with https and came up with the below code. Thanks Jesse!</p>. 
<pre class="codeBlock">
addDOMLoadEvent = (function(){
    // create event function stack
    var load_events = [],safari_timer,done,exec,script;
 
 var init = function () {
            done = true;

            // kill the timer
            clearInterval(safari_timer);

            // execute each function in the stack in the order they were added
            while (exec = load_events.shift())
                exec();

            if (script) script.onreadystatechange = '';
        }

    return function (func) {
        // if the init function was already ran, just run this function now and stop
        if (done) return func();

        if (!load_events[0]) {
            // for Mozilla/Opera9
            if (document.addEventListener)
                document.addEventListener("DOMContentLoaded", init, false);
    
   /*@cc_on @*/
   /*@if (@_win32)
   var proto = "src='javascript:void(0)'";
   if (location.protocol == "https:") proto = "src=//0";
   document.write("&lt;scr"+"ipt id=__ie_onload defer " + proto + "><\/scr"+"ipt>");
   var script = document.getElementById("__ie_onload");
   script.onreadystatechange = function() {
    if (this.readyState == "complete") {
     init()
    }
   };
   /*@end @*/

            if (/WebKit/i.test(navigator.userAgent)) { // sniff
                safari_timer = setInterval(function() {
                    if (/loaded|complete/.test(document.readyState))
                        init(); // call the onload handler
                }, 10);
            }

            old_onload = window.onload;
            window.onload = function() {
                init();
                if (old_onload) old_onload();
            };
        }

        load_events.push(func);
    }
})();
</pre><div style="clear:both; padding-bottom:0.25em"></div><p class="blogger-labels">Labels: <a rel='tag' href="http://www.tomhoppe.com/labels/All.html">All</a>, <a rel='tag' href="http://www.tomhoppe.com/labels/Javascript.html">Javascript</a></p>
            </div>
		</div>

		<p class="post-footer">
			<em>posted by Tom Hoppe at 5:45 PM</em>
			  
            
		</p>

	</div>
	<!-- End .post -->
    
  	<!-- Begin #comments -->
	
	<div id="comments">

	<a name="comments"></a>
        <h4>0 Comments:</h4>
        <dl id="comments-block">
      
    </dl>
	
    <p class="comment-timestamp">
    	<a class="comment-link" href="https://www.blogger.com/comment.g?blogID=6064498188306872783&postID=8232425268208005748&isPopup=true" onclick="window.open(this.href, 'bloggerPopup', 'toolbar=0,scrollbars=1,location=0,statusbar=1,menubar=0,resizable=1,width=400,height=450');return false;">Post a Comment</a>
    </p>
    	    

    


	<p class="comment-timestamp">
	<a href="http://www.tomhoppe.com/">&lt;&lt; Home</a>
    </p>
    </div>

	

  	<!-- End #comments -->

	
	</div>
	</div>

	<!-- End #main -->


	<!-- Begin #sidebar -->
	<div id="sidebar"><div id="sidebar2">
   
	<h2 class="sidebar-title">Previous Posts</h2>
    	<ul id="recently">
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/drag-and-drop-javascript.html">Drag and drop Javascript</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/dynamically-adding-css-through.html">Dynamically adding CSS through Javascript</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/mini-cooper.html">Mini Cooper!</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/cross-sub-domain-javascript-ajax-iframe.html">Cross Sub Domain Javascript (Ajax, Iframe, etc)</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/cross-browser-self-closing-popup-window.html">Cross browser, self closing popup window</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/house-update.html">House Update....</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/race-car-update.html">Race Car Update</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/03/so-now-that-ive-got-blog.html">So now that I&#39;ve got a &quot;blog&quot;</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/02/add-class-name-to-div-id.html">Add class name to div id</a></li>
		    
        	<li><a href="http://www.tomhoppe.com/2008/02/snipper-for-grabbing-filename-from.html">Grab filename from window location</a></li>
		    
            <li><a href="http://www.tomhoppe.com/labels/All.html">All Previous</a></li>
		</ul>
        
    <h2 class="sidebar-title">Categories</h2>
   	<ul>
    	<li><a href="http://www.tomhoppe.com/labels/All.html">All</a></li>
        <li><a href="http://www.tomhoppe.com/labels/CSS.html">CSS</a></li>
    	<li><a href="http://www.tomhoppe.com/labels/General.html">General (Misc)</a></li>
        <li><a href="http://www.tomhoppe.com/labels/Javascript.html">Javascript</a></li>
        <li><a href="http://www.tomhoppe.com/labels/Jeep.html">Jeep</a></li>
        <li><a href="http://www.tomhoppe.com/labels/Pictures.html">Pictures</a></li>
        <li><a href="http://www.tomhoppe.com/labels/Racing.html">Racing</a></li>
    </ul>
    
    
  
	

	<p id="powered-by" style="padding:0 0 10px 0;"><a href="http://www.blogger.com"><img src="http://buttons.blogger.com/bloggerbutton1.gif" alt="Powered by Blogger" border="0" /></a></p>

	</div></div>
<!-- End #sidebar -->
	
</div>
<div style="clear:both;"></div>
<!-- END OF BLOG -->
</div>
</div></div></div>

<!-- START OF BOTTOM SECTION -->	
<div id="borderBottom" class="clearfix">
	<img src="http://www.tomhoppe.com/images/cornerBL.gif" width="12" height="22" alt="" border="0" class="cornerL" />
	<img src="http://www.tomhoppe.com/images/cornerBR.gif" width="12" height="22" alt="" border="0" class="cornerR" />
</div>
<!-- END OF BOTTOM SECTION -->
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4655438-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</body>

</html>